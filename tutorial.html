<!doctype html>
<html >
<head>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <!--[if lt IE 9]>
                <script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
        <![endif]-->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />

    <!-- <link rel="stylesheet" type="text/css" href="template.css" /> -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/template.css" />

    <link href="https://vjs.zencdn.net/5.4.4/video-js.css" rel="stylesheet" />

    <script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
    <!-- <script type='text/javascript' src='menu/js/jquery.cookie.js'></script> -->
    <!-- <script type='text/javascript' src='menu/js/jquery.hoverIntent.minified.js'></script> -->
    <!-- <script type='text/javascript' src='menu/js/jquery.dcjqaccordion.2.7.min.js'></script> -->

    <!-- <link href="menu/css/skins/blue.css" rel="stylesheet" type="text/css" /> -->
    <!-- <link href="menu/css/skins/graphite.css" rel="stylesheet" type="text/css" /> -->
    <!-- <link href="menu/css/skins/grey.css" rel="stylesheet" type="text/css" /> -->
  
    <!-- <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->
        
  
    <!-- <script src="script.js"></script> -->
  
    <!-- <script src="jquery.sticky-kit.js "></script> -->
    <script type='text/javascript' src='https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/js/jquery.cookie.js'></script>
    <script type='text/javascript' src='https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/js/jquery.hoverIntent.minified.js'></script>
    <script type='text/javascript' src='https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/js/jquery.dcjqaccordion.2.7.min.js'></script>

    <link href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/css/skins/blue.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/css/skins/graphite.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/css/skins/grey.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/ryangrose/easy-pandoc-templates@948e28e5/css/elegant_bootstrap.css" rel="stylesheet" type="text/css" />
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  
    <script src="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/script.js"></script>
  
    <script src="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/jquery.sticky-kit.js"></script>
    <meta name="generator" content="pandoc" />
  <title>Securely Containerize a CLI Application with Chainguard Images</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>

    
    <div class="navbar navbar-static-top">
    <div class="navbar-inner">
      <div class="container">
        <span class="doc-title">Securely Containerize a CLI Application with Chainguard Images</span>
        <ul class="nav pull-right doc-info">
                            </ul>
      </div>
    </div>
  </div>
    <div class="container">
    <div class="row">
            <div id="TOC" class="span3">
        <div class="well toc">

        <ul>
        <li><a href="#overview">Overview</a></li>
        <li><a href="#creating-the-application">Creating the Application</a></li>
        <li><a href="#multi-stage-build-using-chainguard-images">Multi-Stage Build Using Chainguard Images</a></li>
        <li><a href="#advantages-of-chainguard-images">Advantages of Chainguard Images</a></li>
        </ul>

        </div>
      </div>
            <div class="span9">

      
      <h1 id="overview">Overview</h1>
<p>Containerization technologies such as Docker have revolutionized the development to production pipeline, making it easier than ever to reproduce environments and set up and maintain infrastructure. Unfortunately, containers come with their own risks and overhead. While standard images can be convenient for development, putting large images into production increases the attack surface and can demand additional and unnecessary resources in deployment.</p>
<p>In this tutorial, we’ll build on a <a href="https://www.chainguard.dev/chainguard-images">Chainguard Image</a> to containerize a Python application in a multi-stage build process. By using a Chainguard Image, our containerized application benefits from a minimalist design that reduces attack surface and from a set of features focused on security and ease of development. In addition, the use of a multistage build process will allow us to develop our application with access to tools such as package managers while removing these potential vulnerabilities later in the build process.</p>
<h1 id="creating-the-application">Creating the Application</h1>
<p>The Python application we will containerize in this tutorial, Chainguard Timeteller, will provide the user with the local time in ten randomly chosen international timezones. It also displays the time in UTC and in the user’s local timezone. The application depends on <a href="https://pypi.org/project/pytz/">pytz</a>, allowing us to draw from the <a href="https://en.wikipedia.org/wiki/Tz_database">Olson tz database</a> in selecting our random timezones.</p>
<p>Let’s start by creating our main application script.
First, open your terminal and run the below line to create a new folder called <code>timeteller</code> in your home directory:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="fu">mkdir</span> ~/timeteller <span class="kw">&amp;&amp;</span> <span class="bu">cd</span> ~/timeteller</a></code></pre></div>
<p>Open a new file called <code>main.py</code> in your preferred text editor. We’ll use the widely available <a href="https://en.wikipedia.org/wiki/GNU_nano">Nano</a> editor in this tutorial.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1"><span class="fu">nano</span> main.py</a></code></pre></div>
<p>Copy the following Python code into <code>main.py</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb3-1" title="1"><span class="im">from</span> datetime <span class="im">import</span> datetime</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="im">from</span> time <span class="im">import</span> tzname</a>
<a class="sourceLine" id="cb3-3" title="3"><span class="im">from</span> random <span class="im">import</span> sample</a>
<a class="sourceLine" id="cb3-4" title="4"><span class="im">from</span> pytz <span class="im">import</span> timezone, common_timezones</a>
<a class="sourceLine" id="cb3-5" title="5"></a>
<a class="sourceLine" id="cb3-6" title="6"></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="kw">def</span> tz_aware_now(tz<span class="op">=</span>timezone(<span class="st">&quot;utc&quot;</span>)):</a>
<a class="sourceLine" id="cb3-8" title="8">    <span class="co">&quot;&quot;&quot;Create a timezone-aware datetime for the current time and a provided timezone. Defaults to UTC.&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb3-9" title="9">    now <span class="op">=</span> datetime.now(tz)</a>
<a class="sourceLine" id="cb3-10" title="10"></a>
<a class="sourceLine" id="cb3-11" title="11">    <span class="cf">return</span> now</a>
<a class="sourceLine" id="cb3-12" title="12"></a>
<a class="sourceLine" id="cb3-13" title="13"></a>
<a class="sourceLine" id="cb3-14" title="14"><span class="kw">def</span> pretty_print_time(t):</a>
<a class="sourceLine" id="cb3-15" title="15">    <span class="co">&quot;&quot;&quot;Given a datetime object, return a human-readable and nicely-formatted time string..&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb3-16" title="16"></a>
<a class="sourceLine" id="cb3-17" title="17">    <span class="co"># Generate an ordinal suffix, i.e. &quot;th&quot; or &quot;st&quot; based on the day</span></a>
<a class="sourceLine" id="cb3-18" title="18">    day <span class="op">=</span> t.day</a>
<a class="sourceLine" id="cb3-19" title="19">    day_ordinal_suffix <span class="op">=</span> <span class="bu">str</span>(day) <span class="op">+</span> (</a>
<a class="sourceLine" id="cb3-20" title="20">        <span class="st">&quot;th&quot;</span></a>
<a class="sourceLine" id="cb3-21" title="21">        <span class="cf">if</span> <span class="dv">4</span> <span class="op">&lt;=</span> day <span class="op">%</span> <span class="dv">100</span> <span class="op">&lt;=</span> <span class="dv">20</span></a>
<a class="sourceLine" id="cb3-22" title="22">        <span class="cf">else</span> {<span class="dv">1</span>: <span class="st">&quot;st&quot;</span>, <span class="dv">2</span>: <span class="st">&quot;dayd&quot;</span>, <span class="dv">3</span>: <span class="st">&quot;rd&quot;</span>}.get(day <span class="op">%</span> <span class="dv">10</span>, <span class="st">&quot;th&quot;</span>)</a>
<a class="sourceLine" id="cb3-23" title="23">    )</a>
<a class="sourceLine" id="cb3-24" title="24"></a>
<a class="sourceLine" id="cb3-25" title="25">    date_pretty <span class="op">=</span> <span class="st">&quot; &quot;</span>.join([t.strftime(<span class="st">&quot;%-I:%M %p on %B&quot;</span>), day_ordinal_suffix])</a>
<a class="sourceLine" id="cb3-26" title="26"></a>
<a class="sourceLine" id="cb3-27" title="27">    <span class="cf">return</span> date_pretty</a>
<a class="sourceLine" id="cb3-28" title="28"></a>
<a class="sourceLine" id="cb3-29" title="29"></a>
<a class="sourceLine" id="cb3-30" title="30"><span class="kw">def</span> generate_timezone_message():</a>
<a class="sourceLine" id="cb3-31" title="31">    <span class="co">&quot;&quot;&quot;Create the message to display to a user. The message includes a greeting, the current time in UTC, the user&#39;s local timezone and time, and ten local times from randomly selected timezones.&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb3-32" title="32"></a>
<a class="sourceLine" id="cb3-33" title="33">    local_time <span class="op">=</span> tz_aware_now(tz_aware_now().astimezone().tzinfo)</a>
<a class="sourceLine" id="cb3-34" title="34"></a>
<a class="sourceLine" id="cb3-35" title="35">    random_timezones <span class="op">=</span> sample(common_timezones, <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb3-36" title="36"></a>
<a class="sourceLine" id="cb3-37" title="37">    timezones_map <span class="op">=</span> {</a>
<a class="sourceLine" id="cb3-38" title="38">        zone: pretty_print_time(tz_aware_now(timezone(zone)))</a>
<a class="sourceLine" id="cb3-39" title="39">        <span class="cf">for</span> zone <span class="kw">in</span> random_timezones</a>
<a class="sourceLine" id="cb3-40" title="40">    }</a>
<a class="sourceLine" id="cb3-41" title="41"></a>
<a class="sourceLine" id="cb3-42" title="42">    printable_timezones <span class="op">=</span> [</a>
<a class="sourceLine" id="cb3-43" title="43">        <span class="st">&quot; &quot;</span>.join([<span class="st">&quot;    &quot;</span>, <span class="st">&quot;➤&quot;</span>, zone, timezones_map[zone]]) <span class="cf">for</span> zone <span class="kw">in</span> timezones_map</a>
<a class="sourceLine" id="cb3-44" title="44">    ]</a>
<a class="sourceLine" id="cb3-45" title="45"></a>
<a class="sourceLine" id="cb3-46" title="46">    message <span class="op">=</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>.join(</a>
<a class="sourceLine" id="cb3-47" title="47">        [</a>
<a class="sourceLine" id="cb3-48" title="48">            <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Welcome to Chainguard Timeteller! </span><span class="ch">\n</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb3-49" title="49">            <span class="ss">f&quot;🌎 The current time in UTC is </span><span class="sc">{</span>pretty_print_time(tz_aware_now())<span class="sc">}</span><span class="ss">.&quot;</span>,</a>
<a class="sourceLine" id="cb3-50" title="50">            <span class="ss">f&quot;❓ Your current timezone is </span><span class="sc">{</span>tzname[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">.&quot;</span>,</a>
<a class="sourceLine" id="cb3-51" title="51">            <span class="ss">f&quot;⏰ Your local time is </span><span class="sc">{</span>pretty_print_time(local_time)<span class="sc">}</span><span class="ss">.</span><span class="ch">\n</span><span class="ss">&quot;</span>,</a>
<a class="sourceLine" id="cb3-52" title="52">            <span class="st">&quot;Local times from ten randomly chosen timezones around the world:</span><span class="ch">\n</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb3-53" title="53">            <span class="op">*</span>printable_timezones,</a>
<a class="sourceLine" id="cb3-54" title="54">        ]</a>
<a class="sourceLine" id="cb3-55" title="55">    )</a>
<a class="sourceLine" id="cb3-56" title="56"></a>
<a class="sourceLine" id="cb3-57" title="57">    <span class="cf">return</span> message</a>
<a class="sourceLine" id="cb3-58" title="58"></a>
<a class="sourceLine" id="cb3-59" title="59"></a>
<a class="sourceLine" id="cb3-60" title="60"><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</a>
<a class="sourceLine" id="cb3-61" title="61">    <span class="bu">print</span>(generate_timezone_message())</a></code></pre></div>
<p>If you’re using Nano, you can save the file by pressing <code>Control-x</code>, <code>y</code>, and <code>Enter</code> in sequence.</p>
<p>In this script, we define functions to return the current time in a specific timezone, generate nicely-formatted lines for each region, and pull together a message to the user. When run directly, the script prints the generated message, including the time in ten randomly selected timezones, to the console. The code depends on a library, pytz, not in the standard library, and we’ll have to install it during our build process.</p>
<p>Because our code depends on <code>pytz</code>, a package not in Python’s standard library, we’ll also need to specify our dependencies. Open a <code>requirements.txt</code> file using your text editor:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" title="1"><span class="fu">nano</span> requirements.txt</a></code></pre></div>
<p>Copy the below into the file.</p>
<pre><code>pytz==2024.1</code></pre>
<p>Here, we specify the version of <code>pytz</code> we want to use. Once you’re done, save the file.</p>
<p>Before we build our container, let’s test that our script works. First, install our dependency using the pip package manager:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" title="1"><span class="ex">pip</span> install -r requirements.txt</a></code></pre></div>
<p>Depending on your system, you may need to use the <code>pip3</code> command instead of the <code>pip</code> command.</p>
<p>Once <code>pytz</code> has installed, run the script with the below command:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb7-1" title="1">python main.py</a></code></pre></div>
<p>Depending on your system, you may need to use the <code>python3</code> command instead of the <code>python</code> command. You should receive output similar to the following:</p>
<pre><code>
Welcome to Chainguard Timeteller! 

🌎 The current time in UTC is 6:07 PM on February 18th.
❓ Your current timezone is EST.
⏰ Your local time is 1:07 PM on February 18th.

Local times from ten randomly chosen timezones around the world:

     ➤ Europe/Dublin 6:07 PM on February 18th
     ➤ Africa/Lagos 7:07 PM on February 18th
     ➤ America/Tortola 2:07 PM on February 18th
     [...]</code></pre>
<p>When you see the above output with local times in ten randomly-selected timezones, you’ll know the application is working. You’re ready to containerize Timeteller using a base image from Chainguard Images.</p>
<h1 id="multi-stage-build-using-chainguard-images">Multi-Stage Build Using Chainguard Images</h1>
<p>Now that we have our application in place, we’re ready to containerize it using a multi-stage build process. This build process works as follows:</p>
<ol type="1">
<li>We begin the build by pulling a development version of the <code>python-latest</code> Chainguard Image as our base image.</li>
<li>We copy the <code>requirements.txt</code> file to the image, activate our virtual environment, and install our dependency using <code>pip</code>.</li>
<li>We now pull the minimal runtime version of the <code>python-latest</code> image. This image does not contain pip or an interactive shell.</li>
<li>We copy our virtual environment (now with access to our dependency) from the dev image to the minimal runtime image.</li>
<li>We activate our virtual environment on the minimal runtime image and run the application.</li>
</ol>
<p>Create a file named <code>Dockerfile</code> in your <code>timeteller</code> folder:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb9-1" title="1"><span class="fu">nano</span> Dockerfile</a></code></pre></div>
<p>Copy the following build instructions to the Dockerfile:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode dockerfile"><code class="sourceCode dockerfile"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">FROM</span> cgr.dev/chainguard/python:latest-dev as builder</a>
<a class="sourceLine" id="cb10-2" title="2"></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="kw">ENV</span> LANG=C.UTF-8</a>
<a class="sourceLine" id="cb10-4" title="4"><span class="kw">ENV</span> PYTHONDONTWRITEBYTECODE=1</a>
<a class="sourceLine" id="cb10-5" title="5"><span class="kw">ENV</span> PYTHONUNBUFFERED=1</a>
<a class="sourceLine" id="cb10-6" title="6"><span class="kw">ENV</span> PATH=<span class="st">&quot;/timeteller/venv/bin:$PATH&quot;</span></a>
<a class="sourceLine" id="cb10-7" title="7"></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="kw">WORKDIR</span> /timeteller</a>
<a class="sourceLine" id="cb10-9" title="9"></a>
<a class="sourceLine" id="cb10-10" title="10"><span class="kw">RUN</span> python -m venv /timeteller/venv</a>
<a class="sourceLine" id="cb10-11" title="11"><span class="kw">COPY</span> requirements.txt .</a>
<a class="sourceLine" id="cb10-12" title="12"></a>
<a class="sourceLine" id="cb10-13" title="13"><span class="kw">RUN</span> pip install --no-cache-dir -r requirements.txt</a>
<a class="sourceLine" id="cb10-14" title="14"></a>
<a class="sourceLine" id="cb10-15" title="15"><span class="kw">FROM</span> cgr.dev/chainguard/python:latest</a>
<a class="sourceLine" id="cb10-16" title="16"></a>
<a class="sourceLine" id="cb10-17" title="17"><span class="kw">ENV</span> TZ=<span class="st">&quot;America/Chicago&quot;</span></a>
<a class="sourceLine" id="cb10-18" title="18"></a>
<a class="sourceLine" id="cb10-19" title="19"><span class="kw">WORKDIR</span> /timeteller</a>
<a class="sourceLine" id="cb10-20" title="20"></a>
<a class="sourceLine" id="cb10-21" title="21"><span class="kw">ENV</span> PYTHONUNBUFFERED=1</a>
<a class="sourceLine" id="cb10-22" title="22"><span class="kw">ENV</span> PATH=<span class="st">&quot;/venv/bin:$PATH&quot;</span></a>
<a class="sourceLine" id="cb10-23" title="23"></a>
<a class="sourceLine" id="cb10-24" title="24"></a>
<a class="sourceLine" id="cb10-25" title="25"><span class="kw">COPY</span> main.py ./</a>
<a class="sourceLine" id="cb10-26" title="26"><span class="kw">COPY</span> --from=builder /timeteller/venv /venv</a>
<a class="sourceLine" id="cb10-27" title="27"></a>
<a class="sourceLine" id="cb10-28" title="28"><span class="kw">ENTRYPOINT</span> [ <span class="st">&quot;python&quot;</span>, <span class="st">&quot;/timeteller/main.py&quot;</span> ]</a></code></pre></div>
<p>Change the timezone in the line <code>ENV TZ="America/Chicago"</code>to your own local timezone. (Without providing this information, the detected timezone in the container would be UTC.)</p>
<p>Save the file. We should now be ready to perform the build. Run the following:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb11-1" title="1"><span class="ex">docker</span> build . -t timeteller</a></code></pre></div>
<p>This will build the image from the instructions in our Dockerfile and tag it with the name <code>timeteller</code>.</p>
<p>If the image build is successful, you’re ready to run it with the following:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb12-1" title="1"><span class="ex">docker</span> run --rm timeteller</a></code></pre></div>
<p>You should see the output from our application as above, including the ten randomly selected local times. Congratulations! You’ve successfully containerized and run an application using Chainguard Images in a multi-stage build process.</p>
<p>The final image based on python:latest does not contain either pip or interactive shells such as <code>sh</code> or <code>bash</code>. Since package managers and shells are common vectors for attackers, having neither as part of our runtime image decreases the attack surface of our application in production. The multi-stage build process allows us to use tools such as shells and package managers during development while allowing us to keep our production image securely minimal.</p>
<h1 id="advantages-of-chainguard-images">Advantages of Chainguard Images</h1>
<p>Chainguard Images provide a happy medium between superminimal images such as <a href="https://hub.docker.com/_/scratch/">scratch</a> and more complex distribution-based images such as Alpine or Debian. Chainguard Images aim specifically to reduce complexity, intentionally including only those software components necessary for runtime. Further, Chainguard Images are based on a distroless philosophy, meaning that they strip out additional software components traditionally associated with a distribution. Typically, a Chainguard Image contains only an application runtime, root certificates, a minimal file structure, and a small number of core system libraries.</p>
<p>Each Chainguard Image comes with a comprehensive SBOM (Software Bill of Materials). This allows users of Chainguard Images to check against known vulnerabilities, adhere to the legal terms of software licenses, and ensure software integrity.</p>
<p>Finally, the focus on minimal builds results in significantly fewer CVEs on your runtime images. Before we end this tutorial, let’s scan for CVEs in our Timeteller image using an industry-standard tool, <a href="https://docs.docker.com/scout/">Docker Scout</a>.</p>
<p>To use Docker Scout, you’ll first have to have a <a href="https://hub.docker.com">Docker Hub</a> account. Follow the <a href="https://github.com/docker/scout-cli?tab=readme-ov-file#cli-plugin-installation">installation instructions for Docker Scout on GitHub</a>. Once Docker Scout is installed, you can sign in to Docker Hub on the command line with the <code>docker login</code> command.</p>
<p>Once we have Docker Scout installed, we can use it to scan for vulnerabilities with the following command:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb13-1" title="1"><span class="ex">docker</span> scout cves timeteller</a></code></pre></div>
<p>Running Docker Scout on our Timeteller image (built from a Chainguard Image) on February 18th, 2024 produced the following report:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode markdown"><code class="sourceCode markdown"><a class="sourceLine" id="cb14-1" title="1"><span class="bn">    ✓ Image stored for indexing</span></a>
<a class="sourceLine" id="cb14-2" title="2"><span class="bn">    ✓ Indexed 32 packages</span></a>
<a class="sourceLine" id="cb14-3" title="3"><span class="bn">    ✓ No vulnerable package detected</span></a>
<a class="sourceLine" id="cb14-4" title="4"></a>
<a class="sourceLine" id="cb14-5" title="5"></a>
<a class="sourceLine" id="cb14-6" title="6"><span class="fu">## Overview</span></a>
<a class="sourceLine" id="cb14-7" title="7"></a>
<a class="sourceLine" id="cb14-8" title="8"><span class="bn">                    │       Analyzed Image         </span></a>
<a class="sourceLine" id="cb14-9" title="9">────────────────────┼──────────────────────────────</a>
<a class="sourceLine" id="cb14-10" title="10">  Target            │  timeteller:latest           </a>
<a class="sourceLine" id="cb14-11" title="11"><span class="bn">    digest          │  0cca410be7e4                </span></a>
<a class="sourceLine" id="cb14-12" title="12"><span class="bn">    platform        │ linux/amd64                  </span></a>
<a class="sourceLine" id="cb14-13" title="13"><span class="bn">    vulnerabilities │    0C     0H     0M     0L   </span></a>
<a class="sourceLine" id="cb14-14" title="14"><span class="bn">    size            │ 28 MB                        </span></a>
<a class="sourceLine" id="cb14-15" title="15"><span class="bn">    packages        │ 32                           </span></a>
<a class="sourceLine" id="cb14-16" title="16"></a>
<a class="sourceLine" id="cb14-17" title="17"></a>
<a class="sourceLine" id="cb14-18" title="18"><span class="fu">## Packages and Vulnerabilities</span></a>
<a class="sourceLine" id="cb14-19" title="19"></a>
<a class="sourceLine" id="cb14-20" title="20">  No vulnerable packages detected</a></code></pre></div>
<p>As you can see, no CVEs were detected in the Timeteller image, a relatively rare outcome in the fast-paced world of container vulnerabilities and exposures. While your results with Chainguard Images won’t always be this free of vulnerabilities, using Chainguard Images as your base will reduce your CVE incidence rate by 80% compared to comparable industry alternatives.</p>
<p>In this tutorial, you containerized a Python application with Chainguard Images in a multi-stage build process. This resulted in a runtime image with only the software components required to run our application. This focus on reducing software complexity resulted in a runtime image with a demonstrably low number of CVEs—zero in this case. Now that you understand the advantages of building your production infrastructure on Chainguard Images, you’re ready to go forth and secure your own production environment.</p>
            </div>
    </div>
  </div>
  <script src="https://vjs.zencdn.net/5.4.4/video.js"></script>

</body>
</html>
